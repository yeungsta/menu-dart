@model List<MenuDart.Models.MenuNode>

@{
    ViewBag.Title = "Details";
}

@section Scripts {
	<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
    <script type="text/javascript">
        // do not handle links via ajax by default; Turn off ajax
        $(document).bind("mobileinit", function () { $.mobile.ajaxEnabled = false; });
    </script>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" href="@Url.Content("~/Content/templates/base/index_files/template.css")" type="text/css" />
	<script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
}

<div data-role="page">
	<div data-role="header">
		<div data-role="navbar">
            @if (!string.IsNullOrEmpty(ViewBag.LevelTitle))
            {
		        <center><h2>@ViewBag.LevelTitle</h2></center>
            }
            else if (string.IsNullOrEmpty(ViewBag.UpLevel) || (ViewBag.Parent == "0"))
            {
                <text><center><h2>@ViewBag.Name</h2></center></text>
            }
		</div><!-- /navbar -->
	</div><!-- /header -->

	<div data-role="content">
        @if (ViewBag.Source == "MenuBuilder")
        {
            <text><h2>You're almost done! Now create and organize your menu items.</h2>
            <h3>Just add Categories, then Items. Click on Categories to add more in them.</h3></text>
        }

        @if (!string.IsNullOrEmpty(ViewBag.Text))
        {
		<center>@Html.Raw(ViewBag.Text)<br>
            @Html.ActionLink("Delete", "DeleteText", new { id = ViewBag.MenuId, parent = ViewBag.Parent } )
            @Html.ActionLink("Edit", "EditText", new { id = ViewBag.MenuId, parent = ViewBag.Parent }, null)
        </center>
        }
        else if (ViewBag.Parent != "0")
        {
            <center>@Html.ActionLink("Add Text", "CreateText", new { id = ViewBag.MenuId, parent = ViewBag.Parent }, null)</center>
        }
		<ul data-role="listview" data-inset="true">

        @for (int i = 0; i < Model.Count; i++)
        {
            if (Model[i] is MenuDart.Models.MenuLeaf)
            {
                MenuDart.Models.MenuLeaf currentItem = Model[i] as MenuDart.Models.MenuLeaf;
                
                <li>
					<h3>@currentItem.Title</h3>
					<p>@currentItem.Description</p>
					<span class="ui-li-count">@currentItem.Price</span>
                    <p>
                        @Html.ActionLink("Delete", "Delete", new { id = ViewBag.MenuId, parent = ViewBag.Parent, idx = i }, null)
                        @Html.ActionLink("Edit", "EditItem", new { id = ViewBag.MenuId, parent = ViewBag.Parent, idx = i }, null)
                    </p>
				</li>       
            }
            else
            {
                <li><a href="@ViewBag.MenuId?parent=@ViewBag.Parent&idx=@(i)&ReturnUrl=@ViewBag.ReturnUrl">@Model[i].Title</a>
                <p>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    @Html.ActionLink("Delete", "Delete", new { id = ViewBag.MenuId, parent = ViewBag.Parent, idx = i }, null)
                    @Html.ActionLink("Edit", "Edit", new { id = ViewBag.MenuId, parent = ViewBag.Parent, idx = i }, null)
                </p>
                </li>
            }
        }

		</ul>

        @Html.ActionLink("Add Category", "Create", "MenuTree", new { id = ViewBag.MenuId, parent = ViewBag.Parent }, null)
        <br />
        @Html.ActionLink("Add Item", "CreateItem", "MenuTree", new { id = ViewBag.MenuId, parent = ViewBag.Parent }, null)
        <br />
        <br />
        <br />
        <hr />
        @if (!string.IsNullOrEmpty(ViewBag.UpLevel) && (ViewBag.Parent != "0"))
        {
            @Html.ActionLink("Back one level", "Details", "MenuTree", new { id = ViewBag.MenuId, parent = ViewBag.UpLevel, idx = -1, ReturnUrl = ViewBag.ReturnUrl }, null)
        }
        else
        {
            <text><b>This is the main level.</b></text>
        }
        <br />
        @if (ViewBag.Source == "MenuBuilder")
        {
            @Html.ActionLink("I'm Done with the Menu!", "MenuBuilder9", "Menu", new { id = ViewBag.MenuId }, null)		    	
        }
        else
        {
            @Html.ActionLink("Back to Editor", (string)ViewBag.ReturnUrl, "Menu")
            <text><b>or just "Close" button?</b></text><br />
            @Html.ActionLink("Preview", "PreviewMenu", "Menu", new { id = ViewBag.MenuId }, null)
        }
	</div><!-- /content -->
</div>