@model MenuDart.Models.DashboardModel
           
@{
    ViewBag.Title = "Dashboard";
    int activeCount = 0;
    int monthlyBill = 0;
}

<h2>Your Dashboard (@Model.Email)</h2>

<h3>Menus (@Model.Menus.Count())</h3>

<table>
    <tr>
        <th>
            Name
        </th>
        <th>
            City
        </th>
        <th>
            Active
        </th>
        <th>
            Unique Visitors This Month [@Html.ActionLink("History", "Index", "Dashboard")]
        </th>
        <th></th>
    </tr>

@foreach (var item in Model.Menus)
{
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Name)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.City)
        </td>
        <td>
            @if (@item.Active) {
                activeCount++;
                <text>Yes</text>
            }
            else
            {
               <text>No</text> 
            }
        </td>
        <td>
            300
        </td>
        <td>
            @if (@item.Active) {
                <text>
                @Html.ActionLink("View", "ViewActiveMenu", "Menu", new { id = item.ID }, null) |
                @Html.ActionLink("Edit Menu", "Edit", "Menu", new { id = item.ID }, null) |
                @Html.ActionLink("Deactivate", "Deactivate", "Subscription", new { id = item.ID }, null)
                </text>
            }
            else
            {
                <text>
                @Html.ActionLink("Preview", "PreviewMenu", "Menu", new { id = item.ID }, null) |
                @Html.ActionLink("Edit Menu", "Edit", "Menu", new { id = item.ID }, null) |
                @Html.ActionLink("Activate", "Activate", "Subscription", new { id = item.ID }, null) |
                @Html.ActionLink("Trash", "Delete", "Menu", new { id = item.ID }, null)
                </text>
            }

        </td>
    </tr>
    
    monthlyBill = activeCount * 7;
}
</table>
<br />
@Html.ActionLink("Create a menu", "MenuBuilder", "Menu", null, null)

<br />
<h3>Billing</h3>
<p>
    

    @if (!@Model.TrialEnded)
    {
        <text>
        You are currently on a free month trial, which ends on 1/23/12. Or you can go ahead and @Html.ActionLink("activate all your menu(s) if you'd like.", "ActivateAll", "Subscription", new { email = Model.Email, quantity = @Model.Menus.Count() }, null)
        </text> 
    }
    else if (@Model.Subscribed)
    {
        <text>
        You currently have @activeCount active menu(s) for a total of $@monthlyBill per month. (@activeCount x $7 = $@monthlyBill) [@Html.ActionLink("Deactivate all menu(s)", "DeactivateAll", "Subscription", new { email = Model.Email }, null)]
        </text>
    }
    else
    {
        <text>
        You do not have any active menus. You do not have any charges. [@Html.ActionLink("Activate all menu(s)", "ActivateAll", "Subscription", new { email = Model.Email, quantity = @Model.Menus.Count() }, null)]
        </text>        
    }    
</p>

<h3>Account</h3>
<p>
    Need to change your password? Do it @Html.ActionLink("here", "ChangePassword", "Account").
</p>

<h3>Talk to Us</h3>
<p>
    Have a question? Or just want to give feedback? Our Support Team loves to talk!
    <br />
    Just fill in what you have to say in the form below, and we promise to get back to you over your email (@Model.Email).
</p>

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)

        @Html.HiddenFor(model => model.Email)

        <div class="editor-label">
            @Html.LabelFor(model => model.Feedback, "Question/Feedback")
        </div>
        <div class="editor-field">
            @Html.TextAreaFor(model => model.Feedback, new { style = "width: 300px; height: 250px;" })
            @Html.ValidationMessageFor(model => model.Feedback)
        </div>

        <p>
            <input type="submit" value="Send" />
        </p>
}

